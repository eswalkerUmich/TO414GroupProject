---
title: "TO 414 Group Project 2"
author: "Marcus Frankel, Matthew Dugoff, Emily Walker, Nathan Lee, Young-Bin Kim"
date: "10/31/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Business Question
- The data set in which we are analyzing has 74,111 historic listings on AirBnB. For this project we are focusing solely on the 22,453 LA listings in order to predict the price range within a given city. Variables include both property characteristics like bedrooms and amenities, as well as listing characteristics like average review score and description.
- Business Question: How should LA homeowners set the price of their properties on vacation rental sites?

## Libraries
```{r}
library(class)
library(caret)
library(gmodels)
library(neuralnet)
library(C50)
library(kernlab)
```

# Import and Clean
```{r}
airbnb <- read.csv("train.csv")

airbnb <- subset(airbnb, city == "LA")
airbnb$id <- NULL
airbnb$thumbnail_url <- NULL

airbnb$property_type <- as.factor(airbnb$property_type)
airbnb$room_type <- as.factor(airbnb$room_type)
airbnb$bed_type <- as.factor(airbnb$bed_type)
airbnb$cancellation_policy <- as.factor(airbnb$cancellation_policy)
airbnb$zipcode <- as.factor(airbnb$zipcode)

airbnb$first_review <- NULL
airbnb$latitude <- NULL 
airbnb$longitude <- NULL 
airbnb$name <- NULL
airbnb$city <- NULL

airbnb$neighbourhood <- as.factor(airbnb$neighbourhood)

airbnb$host_has_profile_pic <- ifelse(airbnb$host_has_profile_pic == "t", 1, 0)
airbnb$host_identity_verified <- ifelse(airbnb$host_identity_verified == "t", 1, 0)
airbnb$instant_bookable <- ifelse(airbnb$instant_bookable == "t", 1, 0)
airbnb$host_response_rate <-as.numeric(gsub("%", "", as.character(airbnb$host_response_rate)))

# Create new columns of amenities
airbnb$amenities_TV <- grepl("TV", airbnb$amenities)
airbnb$amenities_kitchen <- grepl("Kitchen", airbnb$amenities)
airbnb$amenities_wifi <- grepl("Internet", airbnb$amenities)
airbnb$amenities_pool <- grepl("Pool", airbnb$amenities)
airbnb$amenities_AC <- grepl("Air conditioning", airbnb$amenities)
airbnb$amenities_gym <- grepl("Gym", airbnb$amenities)
airbnb$amenities_heating <- grepl("Heating", airbnb$amenities)
airbnb$amenities_hottub <- grepl("Hot tub", airbnb$amenities)
airbnb$amenities_lockonbedroomdoor <- grepl("Lock on bedroom", airbnb$amenities)
airbnb$amenities_parking <- grepl("Free parking", airbnb$amenities)

airbnb$desc_length <- sapply(strsplit(airbnb$description, " "), length)

airbnb <- airbnb[complete.cases(airbnb), ]

airbnb_mm <- as.data.frame(model.matrix(~.-1, airbnb[c(1:3, 5:9, 11:13, 15, 17:33)]))

```

## Test and Train Datatsets
```{r}
set.seed(12345)
test_set <- sample(1:nrow(airbnb_mm), 0.7 * nrow(airbnb_mm)) 

#normalize <- function(x) {
#  return ((x - min(x)) / (max(x)- min(x)))
#}

#col_normalize <- airbnb[ , c(5, 6, 13, 18, 19)]
#airbnb_normal[ , c(5, 6, 13, 18, 19)] <- lapply(col_normalize, normalize)

airbnb_train <- airbnb_mm[test_set,] 
airbnb_test <- airbnb_mm[-test_set,]

airbnb_train_labels <- airbnb_mm[test_set, "log_price"]
airbnb_test_labels <- airbnb_mm[-test_set, "log_price"]

str(airbnb_train)

```

## Linear Regression

```{r}
linear_airbnb <- lm(log_price ~ property_type + room_type + accommodates + bathrooms + bed_type + cancellation_policy + cleaning_fee + host_has_profile_pic + host_identity_verified + instant_bookable + neighbourhood + number_of_reviews + review_scores_rating + zipcode + bedrooms + beds, data = airbnb_train)

summary(linear_airbnb)

```

## KNN
```{r}
knn_train <- airbnb_train[,-match("log_price", names(airbnb_train))]
knn_test <- airbnb_test[,-match("log_price", names(airbnb_test))]

sqrt(nrow(airbnb_train))

str(knn_train)

airbnb_knn <- knnregTrain(knn_train, knn_test, airbnb_train_labels, k = 100, use.all = TRUE)

```

## ANN
```{r}
airbnb_ann <- neuralnet(formula = log_price ~., data = airbnb_train, stepmax = 1000000, linear.output = TRUE)

ann_results <- compute(airbnb_ann, airbnb_test)
ann_pred <- ann_results$net.result



```

## Decision Tree

regression tree

cart package


## SVM 
```{r}
airbnb_svm <- ksvm(log_price ~., data = airbnb_train,
                          kernel = "vanilladot")

airbnb_svm_pred <- predict(airbnb_svm, airbnb_test)



```

## analysis

postresample
in carat package


# Combined Prediction Table

```{r}
combined_pred <- data.frame(, airbnb_test$log_price)
str(combined_pred)
```

# Test/Train using Combined Data
```{r}
set.seed(12345)
test_set2 <- sample(1:nrow(combined_pred), 0.7 * nrow(combined_pred)) 

tele_train2 <- combined_pred[test_set2,] 
tele_test2 <- combined_pred[-test_set2,]





